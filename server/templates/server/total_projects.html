{% extends 'server/technical/index.html' %}
{% load static %}


{% block title %}{{ data.title }}{% endblock %}
{% block content %}

<div class="page-wrapper">
			<div class="page-content">

				<div class="row row-cols-1 row-cols-md-2 row-cols-xl-4">
						<div class="col">
							<div class="card radius-10 ">
							 <div class="card-body">
								<div class="d-flex align-items-center">
									<h5 class="mb-0 text-primary">{{ general_statistics.deviation_actual_profit_expected.0 }}руб/{{ general_statistics.deviation_actual_profit_expected.1 }}руб</h5>
									<div class="ms-auto">
                                        <i class="bx bx-cart fs-3 text-primary"></i>
									</div>
								</div>
								<div class="progress my-2" style="height:4px;">
									<div class="progress-bar bg-primary" role="progressbar" style="width: {{ general_statistics.deviation_actual_profit_expected.2 }}%" aria-valuenow="100" aria-valuemin="-100" aria-valuemax="100"></div>
								</div>
								<div class="d-flex align-items-center">
									<p class="mb-0">Отклонение факт прибыли от планируемых затрат</p>
									<p class="mb-0 ms-auto">{{ general_statistics.deviation_actual_profit_expected.2|add:"-100" }}%</p>
								</div>
							</div>
						  </div>
						</div>
						<div class="col">
							<div class="card radius-10">
							<div class="card-body">
								<div class="d-flex align-items-center">
									<h5 class="mb-0 text-success">{{ general_statistics.percentage_payment_received_from_client.0 }}руб/{{ general_statistics.percentage_payment_received_from_client.1 }}руб</h5>
									<div class="ms-auto">
                                        <i class="bx bx-dollar fs-3 text-success"></i>
									</div>
								</div>
								<div class="progress my-2" style="height:4px;">
									<div class="progress-bar bg-success" role="progressbar" style="width: {{ general_statistics.percentage_payment_received_from_client.2 }}%" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100"></div>
								</div>
								<div class="d-flex align-items-center">
									<p class="mb-0">Процент полученной оплаты от клиентов</p>
									<p class="mb-0 ms-auto">{{ general_statistics.percentage_payment_received_from_client.2 }}%</p>
								</div>
							</div>
						  </div>
						</div>
						<div class="col">
							<div class="card radius-10">
							<div class="card-body">
								<div class="d-flex align-items-center">
									<h5 class="mb-0 text-danger">{{ general_statistics.average_deviation_from_budget.0 }}</h5>
									<div class="ms-auto">
                                        <i class="bx bx-group fs-3 text-danger"></i>
									</div>
								</div>
								<div class="progress my-2" style="height:4px;">
									<div class="progress-bar bg-danger" role="progressbar" style="width: {{ general_statistics.average_deviation_from_budget.1 }}%" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100"></div>
								</div>
								<div class="d-flex align-items-center">
									<p class="mb-0">Коэффициент отклонение от бюджета</p>
									<p class="mb-0 ms-auto">{{ general_statistics.average_deviation_from_budget.1|add:"-100"   }}%</p>
								</div>
							</div>
						</div>
						</div>
						<div class="col">
							<div class="card radius-10">
							 <div class="card-body">
								<div class="d-flex align-items-center">
									<h5 class="mb-0 text-warning">{{ general_statistics.overall_project_profitability_percentage.0 }}/{{ general_statistics.overall_project_profitability_percentage.1 }} %</h5>
									<div class="ms-auto">
                                        <i class="bx bx-envelope fs-3 text-warning"></i>
									</div>
								</div>
								<div class="progress my-2" style="height:4px;">
									<div class="progress-bar bg-warning" role="progressbar" style="width: {{ general_statistics.overall_project_profitability_percentage.2 }}%" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100"></div>
								</div>
								<div class="d-flex align-items-center">
									<p class="mb-0">Отклонение рентабельности проектов</p>
									<p class="mb-0 ms-auto">{{ general_statistics.overall_project_profitability_percentage.2|add:"-100"  }}%</p>
								</div>
							</div>
						 </div>
						</div>
					</div><!--end row-->

			<div class="row">
				<div class="col-12 col-lg-8 col-xl-8 d-flex">
				   <div class="card radius-10 w-100">
					<div class="card-body">
						<div class="d-flex align-items-center">
							<div>
								<h6 class="mb-0">Site Traffic</h6>
							</div>
							<div class="font-22 ms-auto"><i class="bx bx-dots-horizontal-rounded"></i>
							</div>
						</div>
						<div class="d-flex align-items-center ms-auto font-13 gap-2 my-3">
							<span class="border px-1 rounded cursor-pointer"><i class="bx bxs-circle me-1" style="color: #14abef"></i>New Visitor</span>
							<span class="border px-1 rounded cursor-pointer"><i class="bx bxs-circle me-1" style="color: #ade2f1"></i>Old Visitor</span>
						</div>
					   <div class="chart-container-1">
						 <canvas id="chart1"></canvas>
					   </div>
					</div>
					<div class="row row-cols-1 row-cols-md-3 row-cols-xl-3 g-0 row-group text-center border-top">
					  <div class="col">
						<div class="p-3">
						  <h5 class="mb-0">{{ min_static_project.0 }}</h5>
						  <small class="mb-0">Всего поставленных задач</small>
						</div>
					  </div>
					  <div class="col">
						<div class="p-3">
						  <h5 class="mb-0">{{ min_static_project.1 }}</h5>
						  <small class="mb-0">Всего затрачено денежных средств</small>
						</div>
					  </div>
					  <div class="col">
						<div class="p-3">
						  <h5 class="mb-0">{{ min_static_project.2 }}</h5>
						  <small class="mb-0">Всего затрачено часов</small>
						</div>
					  </div>
					</div>
				   </div>
				</div>

				<div class="col-12 col-lg-4 col-xl-4 d-flex">
				   <div class="card radius-10 overflow-hidden w-100">
					  <div class="card-body">
						<div class="d-flex align-items-center">
							<div>
								<h6 class="mb-0">Weekly sales</h6>
							</div>
							<div class="font-22 ms-auto text-white"><i class="bx bx-dots-horizontal-rounded"></i>
							</div>
						</div>
						<div class="chart-container-2 my-3">
						  <canvas id="chart2"></canvas>
						 </div>
					  </div>
					  <div class="table-responsive">
						<table class="table align-items-center mb-0">
						  <tbody>
						  {% for projects in project_profit_costs %}
							<tr>
								<td>
									<i class="bx bxs-circle me-2" style="color: #14abef"></i>
									{{ projects.0 }}  <!-- Получаем название проекта -->
								</td>
								<td>{{ projects.1 }} р</td>  <!-- Общая стоимость -->
								 <!-- Фактическая прибыль -->
							</tr>
							{% endfor %}
						  </tbody>
						</table>
					  </div>
					</div>
				</div>
			   </div><!--End Row-->
				<div class="row">
					<div class="col-12 col-lg-12 col-xl-6">
					  <div class="card radius-10">
						<div class="card-body">
							<div class="d-flex align-items-center mb-3">
								<div>
									<h6 class="mb-0 text-uppercase">Column & Line Chart</h6>
								</div>
								<div class="font-22 ms-auto text-white"><i class="bx bx-dots-horizontal-rounded"></i>
								</div>
							</div>
						</div>
						<div class="table-responsive">
						   <table class="table table-hover align-items-center">
							  <thead class="table-light">
								 <tr>
									 <th>Список проектов</th>
									 <th>Ожидаемая прибыль</th>
									 <th>Фактическая прибыль</th>
								 </tr>
							 </thead>
							 <tbody>
							 {% for project in projects_expected_profits %}
								 <tr>
									 <td>{{ project.0 }}</td>
									 <td>{{ project.1 }} руб</td>
									 <td>{{ project.2 }} руб</td>

								 </tr>
							 {% endfor %}

							 </tbody>
						 </table>
						 </div>
					  </div>
					</div>
					<div class="col-12 col-lg-12 col-xl-6">
					   <div class="row">
						 <div class="col-12 col-lg-6">
						   <div class="card radius-10 overflow-hidden">
							<div class="card-body">
							   <p>Фактическая прибыль</p>
							   <h4 class="mb-0">{{ actual_balance }} рублей<small class="font-13"> <i class="zmdi zmdi-long-arrow-up"></i></small></h4>
							</div>
							<div class="chart-container-2">
							  <canvas id="chart3"></canvas>
							</div>
						  </div>
						 </div>
						 <div class="col-12 col-lg-6">
						   <div class="card radius-10 overflow-hidden">
							<div class="card-body">
							   <p>Прогнозируемая прибыль</p>
							   <h4 class="mb-0">{{ forecast_profit_projects }} рублей <small class="font-13"> <i class="zmdi zmdi-long-arrow-up"></i></small></h4>
							</div>
							<div class="chart-container-2">
							 <canvas id="chart4"></canvas>
							 </div>
						  </div>
						 </div>
					   </div>
					</div>
				 </div><!--End Row-->

				 <div class="row">
					<div class="col-12 col-lg-6 col-xl-4 d-flex">
					  <div class="card radius-10 overflow-hidden w-100">
						 <div class="card-body">
						   <p>Средняя соотношение факт часов от планируемых</p>
						   <h4 class="mb-0">{{ list_average_hour_projects.0.1 }}/{{ list_average_hour_projects.0.0 }}</h4>
						   <small>Отклонение: <i class="zmdi zmdi-long-arrow-up">{{ list_average_hour_projects.0.4 }}%</i></small>
						   <hr>
						   <p>Средняя соотношение факт затрат от планируемых</p>
						   <h4 class="mb-0">{{ list_average_hour_projects.0.3 }} руб/{{ list_average_hour_projects.0.2 }} руб</h4>
						   <small>Отклонение: <i class="zmdi zmdi-long-arrow-up">{{ list_average_hour_projects.0.5 }}%</i></small>
						   <div class="mt-5">
						   <div class="chart-container-4">
							 <canvas id="chart5"></canvas>
							</div>
						  </div>
						 </div>
					  </div>
					</div>

					<div class="col-12 col-lg-6 col-xl-8 d-flex">
					   <div class="card radius-10 w-100">
						   <div class="card-header border-bottom bg-transparent">
							<div class="d-flex align-items-center">
								<div>
									<h6 class="mb-0">Customer Review</h6>
								</div>
								<div class="font-22 ms-auto"><i class="bx bx-dots-horizontal-rounded"></i>
								</div>
							</div>
						</div>
						 <ul class="list-group list-group-flush">
							 {% for project in list_projects_hour %}
							<li class="list-group-item bg-transparent">
							  <div class="d-flex align-items-center">
							  <div class="ms-3">
								<h6 class="mb-0">{{ project.0 }} <small class="ml-4">{{ project.4|default:"Отсутствует" }}</small></h6>
								<p class="mb-0 small-font">Выполнено задач: {{ project.1 }}/{{ project.2 }}</p>
							  </div>
								  <div class="ms-auto star">
									  Стадия проекта: {{ project.3 }}
								  </div>
							</div>
							</li>
							 {% endfor %}
						  </ul>
					   </div>
					</div>
				  </div><!--End Row-->
				<h6 class="mb-0 text-uppercase">Отчетность проектов(факт/план)</h6>
				<hr/>
				<div class="card">
					<div class="card-body">
						<div class="table-responsive">
							<table id="example2" class="table table-striped table-bordered">
								<thead>
									<tr>
										<th>Наименование</th>
										<th>Стадия</th>
										<th>Оплачено клиентом</th>
										<th>Планируемая прибыль</th>
										<th>Прогноз прибыли</th>
										<th>Дата начала/завершения</th>
										<th>Выполненых задач</th>
										<th>Ренатбельность проекта</th>
									</tr>
								</thead>
								<tbody>
									{% for project in list_total_reporting_project %}
										<tr>
											<td>{{ project.0 }}</td>
											<td>{{ project.1 }}</td>
											<td>{{ project.2 }}/{{ project.3 }}</td>
											<td>{{ project.4 }}/{{ project.5 }}</td>
											<td>{{ project.11 }} ({{ project.12 }}%)</td>
											<td>{{ project.6 }}/{{ project.7 }}</td>
											<td>{{ project.8 }}%</td>
											<td>{{ project.10 }}%/{{ project.9 }}%</td>
										</tr>
									{% endfor %}
								</tbody>
								<tfoot>

								</tfoot>
							</table>
						</div>
					</div>
				</div>


		</div>
		</div>

<script>
		$(document).ready(function() {
			$('#example').DataTable();
		  } );
	</script>
	<script>
		$(document).ready(function() {
			var table = $('#example2').DataTable( {
				lengthChange: false,
				buttons: [ 'copy', 'excel', 'pdf', 'print']
			} );

			table.buttons().container()
				.appendTo( '#example2_wrapper .col-md-6:eq(0)' );
		} );
	</script>
<script>
  	var totalCosts = {{ total_cost|safe }};

    projectLabels = projectLabels[0].split('","'); // Преобразуем строку в массив

    document.addEventListener("DOMContentLoaded", function () {
        var ctx = document.getElementById("chart22").getContext('2d');
        var myChart = new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: projectLabels, // Используйте преобразованный массив
                datasets: [{
                    backgroundColor: [
                        "#14abef",
                        "#02ba5a",
                    ],
                    data: totalCosts,
                    borderWidth: [0, 0]
                }]
            },
            options: {
                maintainAspectRatio: false,
                cutoutPercentage: 60,
                legend: {
                    position: "bottom",
                    display: false,
                    labels: {
                        fontColor: '#ddd',
                        boxWidth: 15
                    }
                },
                tooltips: {
                    displayColors: false
                }
            }
        });
    });
</script>
{% endblock %}

{% block scripts %}
	<script src="{% static 'server/assets/js/jquery.min.js' %}"></script>
	<script src="{% static 'server/assets/plugins/simplebar/js/simplebar.min.js' %}"></script>
	<script src="{% static 'server/assets/plugins/metismenu/js/metisMenu.min.js' %}"></script>
	<script src="{% static 'server/assets/plugins/perfect-scrollbar/js/perfect-scrollbar.js' %}"></script>
	<script src="{% static 'server/assets/plugins/chartjs/js/Chart.min.js' %}"></script>
	<script src="{% static 'server/assets/plugins/vectormap/jquery-jvectormap-2.0.2.min.js' %}"></script>
    <script src="{% static 'server/assets/plugins/vectormap/jquery-jvectormap-world-mill-en.js' %}"></script>
	<script src="{% static 'server/assets/plugins/jquery.easy-pie-chart/jquery.easypiechart.min.js' %}"></script>
	<script src="{% static 'server/assets/plugins/sparkline-charts/jquery.sparkline.min.js' %}"></script>
	<script src="{% static 'server/assets/plugins/jquery-knob/excanvas.js' %}"></script>
	<script src="{% static 'server/assets/plugins/jquery-knob/jquery.knob.js' %}"></script>
	<script src="{% static 'server/assets/js/index.js'%}"></script>
{% endblock %}